<div align="center">

# Ani-Strm

**一个为 Emby、Jellyfin 服务器提供直链播放的小脚本** 


[关于脚本](#关于脚本) •
[关于Strm](#关于Strm) •
[脚本使用指南](#脚本使用指南) •
[注意事项](#注意事项) •
[TODO LIST](#todo-list) •
[更新日志](#更新日志) •

</div>

## 关于脚本
- 本项目是一款专为Strm文件处理而设计的 Python 脚本工具集，写本脚本的初衷为实现代替手动生成strm文件供给emby的读取，脚本从原理上来讲适用于一切能取得视频文件直链的方式，但由于本脚本的主要目的是满足本人处理Ani Open项目的番剧地址，故而命名仅仅适配了Ani Open的命名格式。若您由其他命名格式的处理需求可提出issue。
- 本脚本为了应付命名规范与否保留了两版，本地版本仅仅能够处理**output.txt** 内编辑而来的直链地址，互动版本仅仅能处理符合命名规范的地址，用户可依特定格式输入视频地址示例及所需生成行数，脚本便能精准创建包含递增集数的多个视频地址，并写入**output.txt**文件。
- 本脚本已在群晖、Debian环境下测试通过。

## 关于Strm


## 脚本使用指南

### （一）环境准备
确保系统安装 Python 3 环境及必要依赖库，如 `urllib.parse`、`re`、`requests`、`logging`、`concurrent.futures`。可使用 `pip install` 命令安装缺失库。

### （二）地址生成与处理
1. 运行脚本，依提示输入视频地址示例，格式为 `https://地址/路径/[团队名] <番名(中文)> - <集数> [<解像度>][<来源>][<获取方法>][<音頻格式> <影像格式>][<字幕语言>].[副檔名]`，例如 `[ANi] 火影忍者 - 01 [1080P][Baha][WEB-DL][AAC AVC][CHT].mp4`。输入后，脚本自动处理特殊字符并规范格式（如替换 `?a=view` 为 `?d=true`）。
2. 输入需生成的行数，脚本依此在 `output.txt` 创建对应数量的视频地址行，集数自动递增并记录日志。

### （三）`.strm` 文件创建
1. 脚本读取并解码 `output.txt` 内容，处理每行地址格式后，依番名在当前目录创建子目录分类存储 `.strm` 文件。
2. 从地址提取文件名，过滤非法字符后创建 `.strm` 文件并写入对应地址行，记录创建日志（含耗时），助用户依番名快速检索播放资源。
3. 脚本采用多编码尝试机制（如 utf-8、gbk、latin-1）读取文件，有效规避编码错误困扰，确保不同编码格式的 output.txt 文件皆能准确处理，增强脚本通用性与适应性。

## 注意事项
### （一）输入格式准确性
严格依要求格式输入视频地址示例，确保方括号、尖括号、中文字符、集数格式（如 01）及文件扩展名等元素准确，错误格式或致处理异常。

### （二）文件编码兼容性
虽脚本尝试多种编码读取 `output.txt`，仍建议保存文件时优先选常见编码（`utf-8`）。若处理非标准编码文件报错，检查编码设置或手动转换格式后再处理。

### （三）链接校验限制
链接校验依赖网络连接与目标服务器响应。网络故障、服务器限制或地址过期可致校验误判或超时，必要时手动检查地址可用性或调整校验策略。

### （四）日志文件管理
脚本按日期生成日志文件（`script_YYYYMMDD.log`），长期运行累积大量日志占用空间，建议定期清理或备份旧日志，依日志排查问题时留意对应日期文件。 

### （五）脚本权限设置与执行
文件权限调整：赋予脚本执行权限，在终端进入脚本所在目录，执行 chmod +x strm.py，使所有者、组及其他用户有执行权，方便从任何目录运行脚本，命令为 ./strm.py

## TODO LIST
- [x] 从 config 文件中读取配置
- [x] 优化程序运行效率（异步处理）

## 更新日志
- 2024.11.27：v1.0，创建粗糙的项目
